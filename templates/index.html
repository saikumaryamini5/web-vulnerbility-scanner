<!DOCTYPE html>
<html>
<head>
    <title>Advanced Web Vulnerability Scanner</title>
    <style>
        body {
            font-family: 'Segoe UI';
            background: #0d1117;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }
        .container {
            background: #161b22;
            padding: 40px;
            border-radius: 16px;
            width: 600px;
            box-shadow: 0 0 20px #000;
        }
        input, textarea {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: none;
        }
        button {
            width: 100%;
            padding: 14px;
            background: #ff4c4c;
            border: none;
            color: white;
            border-radius: 10px;
            cursor: pointer;
        }
        button:hover {
            background: #ff1a1a;
        }
        .vuln-card {
            background: #1c1f26;
            margin-top: 10px;
            padding: 10px;
            border-radius: 10px;
        }
        .critical { border-left: 5px solid #dc3545; }
        .high { border-left: 5px solid #ffc107; }
        .medium { border-left: 5px solid #28a745; }
    </style>
</head>

<body>
<div class="container">
    <h1>ðŸš¨ Web Vulnerability Scanner</h1>

    <input id="targetUrl" type="url" placeholder="https://example.com">

    <label><input type="checkbox" id="customEndpoints" onclick="toggleEndpoints()"> Custom Endpoints</label>
    <textarea id="endpoints" rows="3" style="display:none;"></textarea>

    <button onclick="scan()">Start Scan</button>

    <div id="loading" style="display:none;">Scanning...</div>

    <div id="results" style="display:none; text-align:left; margin-top:20px;">
        <h2>Scan Results</h2>
        <div id="summary"></div>
        <div id="vulnList"></div>

        <button onclick="exportResults()">Export JSON</button>
    </div>
</div>

<script>
function toggleEndpoints() {
    document.getElementById("endpoints").style.display =
        document.getElementById("customEndpoints").checked ? "block" : "none";
}

async function scan() {
    const url = document.getElementById("targetUrl").value;
    const endpoints = document.getElementById("customEndpoints").checked
        ? document.getElementById("endpoints").value.split(",").map(x => x.trim())
        : ["/", "/login", "/search", "/admin", "/api/users"];

    document.getElementById("loading").style.display = "block";
    document.getElementById("results").style.display = "none";

    const r = await fetch("/scan", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({url, endpoints})
    });

    const data = await r.json();
    window.last_results = data;
    showResults(data);

    document.getElementById("loading").style.display = "none";
}

function showResults(data) {
    document.getElementById("summary").innerHTML = `
        <div>
        <b>Total Vulnerabilities:</b> ${data.total_vulns}<br>
        <b>Risk Score:</b> ${data.risk_score}
        </div>
    `;

    let html = "";
    data.results.forEach(r => {
        r.vulnerabilities.forEach(v => {
            html += `
                <div class="vuln-card ${v.severity.toLowerCase()}">
                    <b>${v.type}</b> (${v.severity})<br>
                    Endpoint: ${r.endpoint}<br>
                    ${v.payload ? `Payload: <code>${v.payload}</code>` : ""}
                    ${v.details ? `<br>${v.details}` : ""}
                </div>`;
        });
    });

    document.getElementById("vulnList").innerHTML = html;
    document.getElementById("results").style.display = "block";
}

function exportResults() {
    const blob = new Blob([JSON.stringify(window.last_results, null, 2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "scan-report.json";
    a.click();
}
</script>

</body>
</html>
